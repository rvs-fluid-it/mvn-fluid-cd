<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Fluid Continuous Delivery by rvs-fluid-it</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Fluid Continuous Delivery</h1>
        <p>Maven extension to facilitate continuous delivery of microservices</p>
        <p class="view"><a href="https://github.com/rvs-fluid-it/mvn-fluid-cd">View the Project on GitHub <small>rvs-fluid-it/mvn-fluid-cd</small></a></p>
        <ul>
          <li><a href="https://github.com/rvs-fluid-it/mvn-fluid-cd/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/rvs-fluid-it/mvn-fluid-cd/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/rvs-fluid-it/mvn-fluid-cd">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="surfing-the-continuous-delivery-pipe-" class="anchor" href="#surfing-the-continuous-delivery-pipe-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Surfing the continuous delivery pipe ~</h1>

<p><img src="http://creativecan.com/wp-content/uploads/2012/06/wave-tube_thumb.jpg" alt="Having fun continuously delivering microservices built by Maven"></p>

<h1>
<a id="mvn-fluid-cd" class="anchor" href="#mvn-fluid-cd" aria-hidden="true"><span class="octicon octicon-link"></span></a>mvn-fluid-cd</h1>

<p><a href="http://maven.apache.org">Maven</a> extension(s) to facilitate <a href="http://martinfowler.com/books/continuousDelivery.html">continuous delivery</a> of <a href="http://martinfowler.com/articles/microservices.html">microservices</a></p>

<h2>
<a id="problem-statement-anno-2014" class="anchor" href="#problem-statement-anno-2014" aria-hidden="true"><span class="octicon octicon-link"></span></a>Problem statement (Anno 2014)</h2>

<p><img src="http://www.hydroflex-technology.com/lab/wp-content/uploads/2013/04/broken-surfboard-thumb.jpg" alt="Problem statement"></p>

<blockquote>
<p>Continuously delivering <a href="http://martinfowler.com/articles/microservices.html">microservices</a> built by Maven is tough and painful. </p>
</blockquote>

<ul>
<li><a href="http://www.thoughtworks.com/radar/tools/maven">Technology radar Oktober 2012 - Thoughtworks</a></li>
</ul>

<blockquote>
<p>Maven has long been a staple of build automation in the Java space. However, given its lack of flexibility and support for automation best practices, especially in the Continuous Delivery domain, the use of alternatives such as Gradle should be considered.</p>
</blockquote>

<ul>
<li>
<a href="http://bed-con.org/2014/files/slides/evil_snapshots-bedcon2014.pdf">Evil (Maven) Snapshots - Halil-Cem GÃ¼rsoy</a> </li>
</ul>

<h2>
<a id="as-is-anno-2014" class="anchor" href="#as-is-anno-2014" aria-hidden="true"><span class="octicon octicon-link"></span></a>As Is (Anno 2014)</h2>

<ul>
<li><a href="https://jira.codehaus.org/browse/MNG-5576">Continuous delivery friendly Maven versions (MNG-5576) -&gt; Fixed - Jason van Zyl</a></li>
<li><a href="http://www.slideshare.net/wakaleo/continuous-deliverywithmaven">Real-world strategies for continuous delivery with Maven and Jenkins - John Ferguson Smart</a></li>
<li><a href="http://www.slideshare.net/Takari_io/takari-1">Takari generations - Jason van Zyl</a></li>
</ul>

<h2>
<a id="bringing-back-the-joy" class="anchor" href="#bringing-back-the-joy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bringing back the joy</h2>

<p><img src="http://creativecan.com/wp-content/uploads/2012/06/big-wave-surfing-_thumb3_thumb.jpg" alt="Bringing back the joy ~"></p>

<ul>
<li>Requirements gathering

<ul>
<li>Dave Dev says:

<ul>
<li>
<em>Let me use my snapshots and for the rest stay out of my way ...</em> </li>
</ul>
</li>
<li>Oliver Ops says:

<ul>
<li><em>Freeze! And no adding a revision number in a manifest file is not good enough ...</em></li>
</ul>
</li>
<li>Jerry Jenkins

<ul>
<li><em>I'll do it for you but Keep It Simple Stupid ...</em></li>
</ul>
</li>
<li>...</li>
</ul>
</li>
<li>Scope

<ul>
<li>Java/JVM 1.7</li>
<li>Maven as build tool

<ul>
<li>Tested with 3.2.3 </li>
</ul>
</li>
<li>git, svn as versioning tool</li>
<li><a href="http://paulhammant.com/2013/04/05/what-is-trunk-based-development/">Trunk based development using feature toggles</a></li>
<li>...</li>
</ul>
</li>
<li>
<p>Solution</p>

<p><img src="/mvn-ext-freeze/src/doc/Continuous%20delivery%20with%20Maven.png?raw=true" alt="Solution"></p>

<ul>
<li>Bundle of Maven extensions

<ul>
<li>General design rules for Maven extensions

<ul>
<li>Maximal cohesion, minimal coupling</li>
<li>Less is more

<ul>
<li>Minimize the transitive jar dependencies of the extension</li>
<li>Minimize the inter extension dependencies</li>
</ul>
</li>
<li>Follow or extrapolate existing Maven conventions/principles </li>
<li>Piggyback existing Maven functionality</li>
<li>Not viral

<ul>
<li>Local preprocessing of poms</li>
<li>Pom's stored in a Maven repository are processed poms and do not enforce installation of the extension when depending on these</li>
</ul>
</li>
<li>Graceful degradation when extension is not installed</li>
<li>Does not break the Maven support in the IDE</li>
</ul>
</li>
</ul>
</li>
<li>Algorithm

<ul>
<li>Activate freezing when a revision is provided (-Drevision=xyz)</li>
<li>Start parsing pom.xml file and stream it to frozen.pom.xml </li>
<li>Extract the properties (groupId, artifactId, version) of the pom's project artifact</li>
<li>Replace the snapshot ending of the pom's project artifact version with the given revision number (1.2-SNAPSHOT -&gt; 1.2-xyz)</li>
<li>For each snapshot dependency version encountered while parsing the pom

<ul>
<li>Lookup the latest frozen version of the artifact in Maven's local repository</li>
<li>Replace the version of the dependency whith the latest frozen version</li>
</ul>
</li>
<li>Let the Maven build use the frozen poms instead of the regular poms for all subsequent steps (especially install and deploy)</li>
</ul>
</li>
<li>
<p>See it in action</p>

<p><img src="/mvn-ext-freeze/src/doc/sample-service-dependencies-graph.png?raw=true" alt="Sample"></p>

<ul>
<li>Clone the <em>mvn-fluid-it</em> github project</li>
<li>'cd mvn-ext-s-modules'</li>
<li>Run <em>'mvn clean install'</em> (First run will build the Maven extensions and will copy these to the $M2_HOME/lib/ext folder)</li>
<li>Run <em>'mvn clean install'</em> again (The magic (= the freezing of the snapshots :-)) will now happen because the extensions were installed in the previous step.) </li>
<li>Have a look at the integration tests in <em>'mvn-ext-freeze/src/it'</em>
</li>
<li>(To uninstall the extensions just remove the four jars from the $M2_HOME/lib/ext)</li>
</ul>
</li>
<li>Links

<ul>
<li><a href="https://brettporter.wordpress.com/2010/10/05/creating-a-custom-build-extension-for-maven-3-0/">Creating a Custom Build Extension for Maven 3.0 - Bret Porter</a></li>
<li><a href="http://blog.sonatype.com/2009/05/plexus-container-five-minute-tutorial">Plexus Container Five Minute Tutorial</a></li>
<li><a href="http://maven.apache.org/ref/3.2.3/apidocs/org/apache/maven/eventspy/EventSpy.html">Maven's event spy mechanism</a></li>
<li><a href="http://mojo.codehaus.org/shitty-maven-plugin/index.html"><strong>S</strong> uper <strong>H</strong> elpful <strong>I</strong> ntegration <strong>T</strong> est <strong>T</strong> hingy  , better known as the Shitty plugin</a></li>
<li><a href="http://creativecan.com/2012/06/wave-and-surf-photography/">40 Amazing Examples of Wave and Surf Photography - Creative Commons</a></li>
</ul>
</li>
</ul>
</li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/rvs-fluid-it">rvs-fluid-it</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>